<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Sample size calculation for standard win ratio test • WR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Sample size calculation for standard win ratio test">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">WR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/PW_reg.html">Proportional win-fractions (PW) regression of composite endpoints of death and nonfatal event</a></li>
    <li><a class="dropdown-item" href="../articles/PW_stratify_reg.html">Stratified proportional win-fractions (PW) regression of composite endpoints of death and nonfatal event</a></li>
    <li><a class="dropdown-item" href="../articles/WR_sample_size.html">Sample size calculation for standard win ratio test</a></li>
    <li><a class="dropdown-item" href="../articles/WR_test_rec.html">Two-sample win ratio tests of possibly recurrent event and death</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Sample size calculation for standard win ratio test</h1>
                        <h4 data-toc-skip class="author">Lu Mao (<a href="mailto:lmao@biostat.wisc.edu" class="email">lmao@biostat.wisc.edu</a>)</h4>
            
      

      <div class="d-none name"><code>WR_sample_size.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">INTRODUCTION<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette demonstrates the use of the <code>WR</code> package in
sample size calculation for standard win ratio test of death and
nonfatal event using component-wise hazard ratios as effect size (Mao et
al., 2021, <em>Biometrics</em>).</p>
<div class="section level3">
<h3 id="data-and-the-test">Data and the test<a class="anchor" aria-label="anchor" href="#data-and-the-test"></a>
</h3>
<p>Let <span class="math inline">\(D^{(a)}\)</span> denote the survival
time and <span class="math inline">\(T^{(a)}\)</span> the first nonfatal
event time of a patient in group <span class="math inline">\(a\)</span>,
where <span class="math inline">\(a=1\)</span> indicates the active
treatment and <span class="math inline">\(a=0\)</span> indicates the
control. Likewise, use <span class="math inline">\(C^{(a)}\)</span> to
denote the independent censoring time. In the standard win ratio of
Pocock et al. (2012), the “win” indicator at time <span class="math inline">\(t\)</span> can be written as <span class="math display">\[\mathcal W(D^{(a)},T^{(a)};
D^{(1-a)},T^{(1-a)})(t)=
I(D^{(1-a)}&lt;D^{(a)}\wedge t)+I(D^{(a)}\wedge D^{(1-a)}&gt;t,
T^{(1-a)}&lt;T^{(a)}\wedge t),\]</span> where <span class="math inline">\(b\wedge c=\min(b, c)\)</span>. So the winner goes
to the longer overall survivor or, if both survive past <span class="math inline">\(t\)</span>, the longer event-free survivor. Tweaks
to this rule to incorporate recurrent event are considered in Mao et
al. (2022).</p>
<p>Using this notation, Pocock’s win ratio statistic becomes <span class="math display">\[\begin{equation}\tag{1}
S_n=\frac{\sum_{i=1}^{n_1}\sum_{j=1}^{n_0}\mathcal
W(D_i^{(1)},T_i^{(1)}; D_j^{(0)},T_j^{(0)})
(C_i^{(1)}\wedge C_j^{(0)})}
{\sum_{i=1}^{n_1}\sum_{j=1}^{n_0}\mathcal W(D_j^{(0)},T_j^{(0)};
D_i^{(1)},T_i^{(1)})
(C_i^{(1)}\wedge C_j^{(0)})},
\end{equation}\]</span> where the <span class="math inline">\((D_i^{(a)}, T_i^{(a)}, C_i^{(a)})\)</span> <span class="math inline">\((i=1,\ldots, n_a)\)</span> are a random <span class="math inline">\(n_a\)</span>-sample of <span class="math inline">\((D^{(a)}, T^{(a)}, C^{(a)})\)</span> <span class="math inline">\((a=1, 0)\)</span> (the right hand side of (1) is
indeed computable with censored data). A two-sided level-<span class="math inline">\(\alpha\)</span> win test of group difference
rejects the null if <span class="math inline">\(n^{1/2}|\log
S_n|/\widehat\sigma_n&gt;z_{1-\alpha/2}\)</span>, where <span class="math inline">\(n=n_1+n_0\)</span>, <span class="math inline">\(\widehat\sigma_n^2\)</span> is a consistent
variance estimator, and <span class="math inline">\(z_{1-\alpha/2}\)</span> is the <span class="math inline">\((1-\alpha/2)\)</span>th quantile of the standard
normal distribution. Mao (2019) showed that this test is powerful in
large samples if the treatment stochastically delays death and the
nonfatal event jointly.</p>
</div>
<div class="section level3">
<h3 id="methods-for-sample-size-calculation">Methods for sample size calculation<a class="anchor" aria-label="anchor" href="#methods-for-sample-size-calculation"></a>
</h3>
<p>To simplify sample size calculation, we posit a Gumbel–Hougaard
copula model with marginal proportional hazards structure for <span class="math inline">\(D^{(a)}\)</span> and <span class="math inline">\(T^{(a)}\)</span>: <span class="math display">\[\begin{equation}\tag{2}
{P}(D^{(a)}&gt;s, T^{(a)}&gt;t)
=\exp\left(-\left[\left\{\exp(a\xi_1)\lambda_Ds\right\}^\kappa+
\left\{\exp(a\xi_2)\lambda_Ht\right\}^\kappa\right]^{1/\kappa}\right),
\end{equation}\]</span> where <span class="math inline">\(\lambda_D\)</span> and <span class="math inline">\(\lambda_H\)</span> are the baseline hazards for
death and the nonfatal event, respectively, and <span class="math inline">\(\kappa\geq 1\)</span> controls their correlation
(with Kendall’s concordance <span class="math inline">\(1-\kappa^{-1}\)</span>). The parameters <span class="math inline">\(\boldsymbol\xi:=(\xi_1,\xi_2)^{\rm T}\)</span> are
the component-wise <em>log</em>-hazard ratios comparing the treatment to
control, and will be used an the effect size in sample size calculation.
Further assume that patients are recruited to the trial uniformly in an
initial period <span class="math inline">\([0, \tau_b]\)</span> and
followed up until time <span class="math inline">\(\tau\)</span> <span class="math inline">\((\tau\geq \tau_b)\)</span>, during which they
randomly drop out with an exponential hazard rate of <span class="math inline">\(\lambda_L\)</span>. This leads to <span class="math inline">\(C^{(a)}\sim\mbox{Unif}[\tau-\tau_b,\tau]\wedge\mbox{Expn}(\lambda_L)\)</span>.
The outcome parameters <span class="math inline">\(\lambda_D,
\lambda_H\)</span>, and <span class="math inline">\(\kappa\)</span> may
be estimated from pilot study data if available (see Section 3.2 of Mao
et al. (2021)), whereas the design parameters <span class="math inline">\(\tau_b, \tau,\)</span> and perhaps <span class="math inline">\(\lambda_L\)</span> are best elicited from
investigators of the new trial.</p>
<p>The basic sample size formula is <span class="math display">\[\begin{equation}\tag{3}
n=\frac{\zeta_0^2(z_{1-\beta}+z_{1-\alpha/2})^2}{q(1-q)(\boldsymbol\delta_0^{\rm
T}\boldsymbol\xi)^2},
\end{equation}\]</span> where <span class="math inline">\(q=n_1/n\)</span>, <span class="math inline">\(1-\beta\)</span> is the target power, <span class="math inline">\(\zeta_0\)</span> is a noise parameter similar to
the standard deviation in the <span class="math inline">\(t\)</span>-test, and <span class="math inline">\(\boldsymbol\delta_0\)</span> is a bivariate vector
containing the derivatives of the true win ratio with respect to <span class="math inline">\(\xi_1\)</span> and <span class="math inline">\(\xi_2\)</span>. Under model (2) for the outcomes
and the specified follow-up design, we can calculate <span class="math inline">\(\zeta_0^2\)</span> and <span class="math inline">\(\boldsymbol\delta_0\)</span> as functions of <span class="math inline">\(\lambda_D, \lambda_H, \kappa, \tau_b,
\tau\)</span>, and <span class="math inline">\(\lambda_L\)</span> by
numerical means. Note in particular that they do <em>not</em> depend on
the effect size <span class="math inline">\(\boldsymbol\xi\)</span>.</p>
</div>
</div>
<div class="section level2">
<h2 id="basic-syntax">BASIC SYNTAX<a class="anchor" aria-label="anchor" href="#basic-syntax"></a>
</h2>
<p>The function that implements formula (3) is <code><a href="../reference/WRSS.html">WRSS()</a></code>. We
need to supply at least two arguments: <code>xi</code> for the bivariate
effect size <span class="math inline">\(\boldsymbol\xi\)</span>
(<em>log</em>-hazard ratios) and a list <code>bparam</code> containing
<code>zeta2</code> for <span class="math inline">\(\zeta_0^2\)</span>
and <code>delta</code> for <span class="math inline">\(\boldsymbol\delta_0\)</span>. That is,</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obj</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/WRSS.html">WRSS</a></span><span class="op">(</span><span class="va">xi</span>,<span class="va">bparam</span><span class="op">)</span></span></code></pre></div>
<p>The calculated <span class="math inline">\(n\)</span> can be
extracted from <code>obj$n</code>. The default configurations for <span class="math inline">\(q\)</span>, <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(1-\beta\)</span> are 0.5, 0.05, and 0.8 but can
nonetheless be overridden through optional arguments <code>q</code>,
<code>alpha</code>, and <code>power</code>, respectively. You can also
change the default two-sided test to one-sided by specifying
<code>side=1</code>.</p>
<p>The function <code><a href="../reference/WRSS.html">WRSS()</a></code> itself is almost unremarkable given
the simplicity of the underlying formula. What takes effort is the
computation of <span class="math inline">\(\zeta_0^2\)</span> and <span class="math inline">\(\boldsymbol\delta_0\)</span> needed for
<code>bparam</code>. If you have the parameters <span class="math inline">\(\lambda_D, \lambda_H, \kappa, \tau_b,
\tau\)</span>, and <span class="math inline">\(\lambda_L\)</span> ready,
you can do so by using the <code><a href="../reference/base.html">base()</a></code> function:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bparam</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/base.html">base</a></span><span class="op">(</span><span class="va">lambda_D</span>,<span class="va">lambda_H</span>,<span class="va">kappa</span>,<span class="va">tau_b</span>,<span class="va">tau</span>,<span class="va">lambda_L</span><span class="op">)</span></span></code></pre></div>
<p>where the arguments follow the order of the said parameters. The
returned object <code>bparam</code> can be directly used as argument for
<code><a href="../reference/WRSS.html">WRSS()</a></code> (it is precisely a list containing
<code>zeta2</code> and <code>delta</code> for the computed <span class="math inline">\(\zeta_0^2\)</span> and <span class="math inline">\(\boldsymbol\delta_0\)</span>, respectively). Due
to the numerical complexity, <code><a href="../reference/base.html">base()</a></code> will typically require
some wait time.</p>
<p>Finally, if you have a pilot dataset to estimate <span class="math inline">\(\lambda_D\)</span>, <span class="math inline">\(\lambda_H\)</span>, and <span class="math inline">\(\kappa\)</span> for the baseline outcome
distribution, you can use the <code><a href="../reference/gumbel.est.html">gumbel.est()</a></code> function:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gum</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/gumbel.est.html">gumbel.est</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">time</span>, <span class="va">status</span><span class="op">)</span></span></code></pre></div>
<p>where <code>id</code> is a vector containing the unique patient
identifiers, <code>time</code> a vector of event times, and
<code>status</code> a vector of event type labels: <code>status=2</code>
for nonfatal event, <code>=1</code> for death, and <code>=0</code> for
censoring. The returned object is a list containing real numbers
<code>lambda_D</code>, <code>lambda_H</code>, and <code>kappa</code> for
<span class="math inline">\(\lambda_D\)</span>, <span class="math inline">\(\lambda_H\)</span>, and <span class="math inline">\(\kappa\)</span> respectively. These can then be
fed into <code><a href="../reference/base.html">base()</a></code> to get <code>bparam</code>.</p>
</div>
<div class="section level2">
<h2 id="a-real-example">A REAL EXAMPLE<a class="anchor" aria-label="anchor" href="#a-real-example"></a>
</h2>
<p>We demonstrate the use of the above functions in calculating sample
size for win ratio analysis of death and hospitalization using baseline
parameters estimated from a previous cardiovascular trial.</p>
<div class="section level3">
<h3 id="pilot-data-description">Pilot data description<a class="anchor" aria-label="anchor" href="#pilot-data-description"></a>
</h3>
<p>The Heart Failure: A Controlled Trial Investigating Outcomes of
Exercise Training (HF-ACTION) trial was conducted on a cohort of over
two thousand heart failure patients recruited between 2003–2007 across
the USA, Canada, and France (O’Connor et al., 2009). The study aimed to
assess the effect of adding aerobic exercise training to usual care on
the patient’s composite endpoint of all-cause death and all-cause
hospitalization. We consider a high-risk subgroup consisting of 451
study patients. For detailed information about this subgroup, refer to
the vignette <em>Two-sample win ratio tests of recurrent event and
death</em>.</p>
<p>We first load the package and clean up the baseline dataset for
use.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## load the package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sites.google.com/view/lmaowisc/" class="external-link">WR</a></span><span class="op">)</span></span>
<span><span class="co">## load the dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">hfaction_cpx9</span><span class="op">)</span></span>
<span><span class="va">dat</span><span class="op">&lt;-</span><span class="va">hfaction_cpx9</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="co">#&gt;        patid       time status trt_ab age60</span></span>
<span><span class="co">#&gt; 1 HFACT00001  7.2459016      2      0     1</span></span>
<span><span class="co">#&gt; 2 HFACT00001 12.5573770      0      0     1</span></span>
<span><span class="co">#&gt; 3 HFACT00002  0.7540984      2      0     1</span></span>
<span><span class="co">#&gt; 4 HFACT00002  4.2950820      2      0     1</span></span>
<span><span class="co">#&gt; 5 HFACT00002  4.7540984      2      0     1</span></span>
<span><span class="co">#&gt; 6 HFACT00002 45.9016393      0      0     1</span></span>
<span><span class="co">## subset to the control group (usual care)</span></span>
<span><span class="va">pilot</span><span class="op">&lt;-</span><span class="va">dat</span><span class="op">[</span><span class="va">dat</span><span class="op">$</span><span class="va">trt_ab</span><span class="op">==</span><span class="fl">0</span>,<span class="op">]</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="use-pilot-data-to-estimate-baseline-parameters">Use pilot data to estimate baseline parameters<a class="anchor" aria-label="anchor" href="#use-pilot-data-to-estimate-baseline-parameters"></a>
</h3>
<p>Now, we can use the <code><a href="../reference/gumbel.est.html">gumbel.est()</a></code> functions to estimate
<span class="math inline">\(\lambda_D\)</span>, <span class="math inline">\(\lambda_H\)</span>, and <span class="math inline">\(\kappa\)</span>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id</span><span class="op">&lt;-</span><span class="va">pilot</span><span class="op">$</span><span class="va">patid</span></span>
<span><span class="co">## convert time from month to year</span></span>
<span><span class="va">time</span><span class="op">&lt;-</span><span class="va">pilot</span><span class="op">$</span><span class="va">time</span><span class="op">/</span><span class="fl">12</span></span>
<span><span class="va">status</span><span class="op">&lt;-</span><span class="va">pilot</span><span class="op">$</span><span class="va">status</span></span>
<span><span class="co">## compute the baseline parameters for the Gumbel--Hougaard</span></span>
<span><span class="co">## copula for death and hospitalization</span></span>
<span><span class="va">gum</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/gumbel.est.html">gumbel.est</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">time</span>, <span class="va">status</span><span class="op">)</span></span>
<span><span class="va">gum</span></span>
<span><span class="co">#&gt; $lambda_D</span></span>
<span><span class="co">#&gt; [1] 0.1088785</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $lambda_H</span></span>
<span><span class="co">#&gt; [1] 0.679698</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $kappa</span></span>
<span><span class="co">#&gt; [1] 1.925483</span></span>
<span><span class="va">lambda_D</span><span class="op">&lt;-</span><span class="va">gum</span><span class="op">$</span><span class="va">lambda_D</span></span>
<span><span class="va">lambda_H</span><span class="op">&lt;-</span><span class="va">gum</span><span class="op">$</span><span class="va">lambda_H</span></span>
<span><span class="va">kappa</span><span class="op">&lt;-</span><span class="va">gum</span><span class="op">$</span><span class="va">kappa</span></span></code></pre></div>
<p>This gives us <span class="math inline">\(\widehat\lambda_D=0.11\)</span>, <span class="math inline">\(\widehat\lambda_H=0.68\)</span>, and <span class="math inline">\(\widehat\kappa=1.93\)</span>. Suppose that we are
to launch a new trial that lasts <span class="math inline">\(\tau=4\)</span> years, with an initial accrual
period of <span class="math inline">\(\tau_b=3\)</span> years. Further
suppose that the loss to follow-up rate is <span class="math inline">\(\lambda_L=0.05\)</span> (about half of the
baseline death rate). Combining this set-up with the estimated outcome
parameters, we can calculate <span class="math inline">\(\zeta_0^2\)</span> and <span class="math inline">\(\boldsymbol\delta_0\)</span> using the
<code><a href="../reference/base.html">base()</a></code> function.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## max follow-up 4 years</span></span>
<span><span class="va">tau</span><span class="op">&lt;-</span><span class="fl">4</span></span>
<span><span class="co">## 3 years of initial accrual</span></span>
<span><span class="va">tau_b</span><span class="op">&lt;-</span><span class="fl">3</span></span>
<span><span class="co">## loss to follow-up hazard rate</span></span>
<span><span class="va">lambda_L</span><span class="op">=</span><span class="fl">0.05</span></span>
<span><span class="co">## compute the baseline parameters</span></span>
<span><span class="va">bparam</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/base.html">base</a></span><span class="op">(</span><span class="va">lambda_D</span>,<span class="va">lambda_H</span>,<span class="va">kappa</span>,<span class="va">tau_b</span>,<span class="va">tau</span>,<span class="va">lambda_L</span><span class="op">)</span></span>
<span><span class="va">bparam</span></span>
<span><span class="co">#&gt; $zeta2</span></span>
<span><span class="co">#&gt; [1] 0.2942899</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $w0</span></span>
<span><span class="co">#&gt; [1] 0.4251441</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $delta</span></span>
<span><span class="co">#&gt;     delta1     delta2 </span></span>
<span><span class="co">#&gt; 0.08886542 0.34018646</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="using-wrss-to-compute-sample-size">Using <code>WRSS()</code> to compute sample size<a class="anchor" aria-label="anchor" href="#using-wrss-to-compute-sample-size"></a>
</h3>
<p>Now we can use the computed <code>bparam</code> to calculate sample
size under different combinations of component-wise hazard ratios. We
consider target power <span class="math inline">\(1-\beta=80%\)</span>
and <span class="math inline">\(90%\)</span>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## effect size specification</span></span>
<span><span class="va">thetaD</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.6</span>,<span class="fl">0.95</span>,by<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span> <span class="co">## hazard ratio for death</span></span>
<span><span class="va">thetaH</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.6</span>,<span class="fl">0.95</span>,by<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span> <span class="co">## hazard ratio for hospitalization</span></span>
<span></span>
<span><span class="co">## create a matrix "SS08" for sample size powered at 80% </span></span>
<span><span class="co">## under each combination of thetaD and thetaH</span></span>
<span><span class="va">mD</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">thetaD</span><span class="op">)</span></span>
<span><span class="va">mH</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">thetaH</span><span class="op">)</span></span>
<span><span class="va">SS08</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="va">mD</span>,<span class="va">mH</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">SS08</span><span class="op">)</span><span class="op">&lt;-</span><span class="va">thetaD</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">SS08</span><span class="op">)</span><span class="op">&lt;-</span><span class="va">thetaH</span></span>
<span><span class="co">## fill in the computed sample size values</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">mD</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">mH</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="co">## sample size under hazard ratios thetaD[i] for death and thetaH[j] for hospitalization</span></span>
<span>    <span class="va">SS08</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/WRSS.html">WRSS</a></span><span class="op">(</span>xi<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">thetaD</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="va">thetaH</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,bparam<span class="op">=</span><span class="va">bparam</span>,q<span class="op">=</span><span class="fl">0.5</span>,alpha<span class="op">=</span><span class="fl">0.05</span>,</span>
<span>                       power<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span><span class="op">$</span><span class="va">n</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="co">## print the calculated sample sizes</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">SS08</span><span class="op">)</span></span>
<span><span class="co">#&gt;           0.6     0.65      0.7     0.75       0.8      0.85      0.9      0.95</span></span>
<span><span class="co">#&gt; 0.6  192.3437 250.7878 332.3623 450.1854  627.8914  911.4731 1400.025  2339.457</span></span>
<span><span class="co">#&gt; 0.65 205.4637 270.4621 362.6444 498.4542  708.5504 1055.3200 1681.613  2974.743</span></span>
<span><span class="co">#&gt; 0.7  218.8455 290.8172 394.5283 550.4150  797.9324 1221.1700 2025.550  3825.411</span></span>
<span><span class="co">#&gt; 0.75 232.5145 311.9056 428.1477 606.4539  897.2664 1413.3977 2450.215  4993.647</span></span>
<span><span class="co">#&gt; 0.8  246.4942 333.7800 463.6438 666.9984 1007.9865 1637.4667 2981.054  6648.349</span></span>
<span><span class="co">#&gt; 0.85 260.8071 356.4934 501.1668 732.5254 1131.7759 1900.2707 3654.047  9084.279</span></span>
<span><span class="co">#&gt; 0.9  275.4748 380.1004 540.8778 803.5685 1270.6228 2210.6027 4521.345 12852.227</span></span>
<span><span class="co">#&gt; 0.95 290.5186 404.6569 582.9505 880.7278 1426.8882 2579.8125 5660.714 19076.653</span></span>
<span></span>
<span><span class="co">## repeating the same calculation for power = 90%</span></span>
<span><span class="va">SS09</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="va">mD</span>,<span class="va">mH</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">SS09</span><span class="op">)</span><span class="op">&lt;-</span><span class="va">thetaD</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">SS09</span><span class="op">)</span><span class="op">&lt;-</span><span class="va">thetaH</span></span>
<span><span class="co">## fill in the computed sample size values</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">mD</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">mH</span><span class="op">)</span><span class="op">{</span></span>
<span>     <span class="co">## sample size under hazard ratios thetaD[i] for death and thetaH[j] for hospitalization</span></span>
<span>    <span class="va">SS09</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/WRSS.html">WRSS</a></span><span class="op">(</span>xi<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">thetaD</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="va">thetaH</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,bparam<span class="op">=</span><span class="va">bparam</span>,q<span class="op">=</span><span class="fl">0.5</span>,alpha<span class="op">=</span><span class="fl">0.05</span>,</span>
<span>                       power<span class="op">=</span><span class="fl">0.9</span><span class="op">)</span><span class="op">$</span><span class="va">n</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="co">## print the calculated sample sizes</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">SS09</span><span class="op">)</span></span>
<span><span class="co">#&gt;           0.6     0.65      0.7      0.75       0.8     0.85      0.9      0.95</span></span>
<span><span class="co">#&gt; 0.6  257.4937 335.7337 444.9388  602.6705  840.5684 1220.204 1874.236  3131.869</span></span>
<span><span class="co">#&gt; 0.65 275.0576 362.0720 485.4779  667.2887  948.5479 1412.774 2251.203  3982.337</span></span>
<span><span class="co">#&gt; 0.7  292.9720 389.3217 528.1615  736.8496 1068.2051 1634.800 2711.636  5121.140</span></span>
<span><span class="co">#&gt; 0.75 311.2709 417.5531 573.1683  811.8697 1201.1852 1892.139 3280.143  6685.076</span></span>
<span><span class="co">#&gt; 0.8  329.9858 446.8367 620.6875  892.9217 1349.4079 2192.103 3990.786  8900.253</span></span>
<span><span class="co">#&gt; 0.85 349.1467 477.2435 670.9201  980.6437 1515.1269 2543.923 4891.732 12161.272</span></span>
<span><span class="co">#&gt; 0.9  368.7827 508.8465 724.0820 1075.7503 1701.0034 2959.370 6052.798 17205.486</span></span>
<span><span class="co">#&gt; 0.95 388.9220 541.7208 780.4053 1179.0446 1910.1985 3453.637 7578.090 25538.227</span></span></code></pre></div>
<p>Powered at <span class="math inline">\(80\%\)</span>, the sample size
ranges from 193 at <span class="math inline">\(\exp(\boldsymbol\xi)=(0.6, 0.6)^{\rm T}\)</span>
to 19,077 at <span class="math inline">\(\exp(\boldsymbol\xi)=(0.95,
0.95)^{\rm T}\)</span>; powered at <span class="math inline">\(90\%\)</span>, the sample size ranges from 258 at
<span class="math inline">\(\exp(\boldsymbol\xi)=(0.6, 0.6)^{\rm
T}\)</span> to 25,539 at <span class="math inline">\(\exp(\boldsymbol\xi)=(0.95, 0.95)^{\rm
T}\)</span>. We can even use a 3D plot to display the calculated sample
size as a function of the hazard ratios <span class="math inline">\(\exp(\xi_1)\)</span> and <span class="math inline">\(\exp(\xi_2)\)</span>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oldpar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="st">"mfrow"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/persp.html" class="external-link">persp</a></span><span class="op">(</span><span class="va">thetaD</span>, <span class="va">thetaH</span>, <span class="va">SS08</span><span class="op">/</span><span class="fl">1000</span>, theta <span class="op">=</span> <span class="fl">50</span>, phi <span class="op">=</span> <span class="fl">15</span>, expand <span class="op">=</span> <span class="fl">0.8</span>, col <span class="op">=</span> <span class="st">"gray"</span>,</span>
<span>      ltheta <span class="op">=</span> <span class="fl">180</span>, lphi<span class="op">=</span><span class="fl">180</span>, shade <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>      ticktype <span class="op">=</span> <span class="st">"detailed"</span>,</span>
<span>      xlab <span class="op">=</span> <span class="st">"\n HR on Death"</span>, ylab <span class="op">=</span> <span class="st">"\n HR on Hospitalization"</span>,</span>
<span>      zlab<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"\n Sample Size (10e3)"</span><span class="op">)</span>,</span>
<span>      main<span class="op">=</span><span class="st">"Power = 80%"</span>,</span>
<span>      zlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">26</span><span class="op">)</span>,cex.axis<span class="op">=</span><span class="fl">1</span>,cex.lab<span class="op">=</span><span class="fl">1.2</span>,cex.main<span class="op">=</span><span class="fl">1.2</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/persp.html" class="external-link">persp</a></span><span class="op">(</span><span class="va">thetaD</span>, <span class="va">thetaH</span>, <span class="va">SS09</span><span class="op">/</span><span class="fl">1000</span>, theta <span class="op">=</span> <span class="fl">50</span>, phi <span class="op">=</span> <span class="fl">15</span>, expand <span class="op">=</span> <span class="fl">0.8</span>, col <span class="op">=</span> <span class="st">"gray"</span>,</span>
<span>      ltheta <span class="op">=</span> <span class="fl">180</span>, lphi<span class="op">=</span><span class="fl">180</span>, shade <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>      ticktype <span class="op">=</span> <span class="st">"detailed"</span>,</span>
<span>      xlab <span class="op">=</span> <span class="st">"\nHR on Death"</span>, ylab <span class="op">=</span> <span class="st">"\nHR on Hospitalization"</span>,</span>
<span>      zlab<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"\n Sample Size (10e3)"</span><span class="op">)</span>,</span>
<span>      main<span class="op">=</span><span class="st">"Power = 90%"</span>,</span>
<span>      zlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">26</span><span class="op">)</span>,cex.axis<span class="op">=</span><span class="fl">1</span>,cex.lab<span class="op">=</span><span class="fl">1.2</span>,cex.main<span class="op">=</span><span class="fl">1.2</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="WR_sample_size_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">oldpar</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li><p>Mao, L. (2019). On the alternative hypotheses for the win ratio.
<em>Biometrics</em>, 75, 347-351. <a href="https://doi.org/10.1111/biom.12954" class="external-link uri">https://doi.org/10.1111/biom.12954</a>.</p></li>
<li><p>Mao, L., Kim, K., &amp; Li, Y. (2022). On recurrent-event win
ratio. <em>Statistical Methods in Medical Research</em>, under
review.</p></li>
<li><p>Mao, L., Kim, K., &amp; Miao, X. (2021). Sample size formula for
general win ratio analysis. <em>Biometrics</em>, <a href="https://doi.org/10.1111/biom.13501" class="external-link uri">https://doi.org/10.1111/biom.13501</a>.</p></li>
<li><p>O’Connor, C. M., Whellan, D. J., Lee, K. L., Keteyian, S. J.,
Cooper, L. S., Ellis, S. J., Leifer, E. S., Kraus, W. E., Kitzman, D.
W., Blumenthal, J. A. et al. (2009). “Efficacy and safety of exercise
training in patients with chronic heart failure: HF-ACTION randomized
controlled trial”. <em>Journal of the American Medical Association</em>,
301, 1439–1450.</p></li>
<li><p>Pocock, S., Ariti, C., Collier, T., and Wang, D. (2012). The win
ratio: a new approach to the analysis of composite endpoints in clinical
trials based on clinical priorities. <em>European Heart Journal</em>,
33, 176–182.</p></li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Lu Mao.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
