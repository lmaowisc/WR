<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Proportional win-fractions (PW) regression of composite endpoints of death and nonfatal event ‚Ä¢ WR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Proportional win-fractions (PW) regression of composite endpoints of death and nonfatal event">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">WR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/PW_reg.html">Proportional win-fractions (PW) regression of composite endpoints of death and nonfatal event</a></li>
    <li><a class="dropdown-item" href="../articles/PW_stratify_reg.html">Stratified proportional win-fractions (PW) regression of composite endpoints of death and nonfatal event</a></li>
    <li><a class="dropdown-item" href="../articles/WR_sample_size.html">Sample size calculation for standard win ratio test</a></li>
    <li><a class="dropdown-item" href="../articles/WR_test_rec.html">Two-sample win ratio tests of possibly recurrent event and death</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Proportional win-fractions (PW) regression of composite endpoints of death and nonfatal event</h1>
                        <h4 data-toc-skip class="author">Lu Mao (<a href="mailto:lmao@biostat.wisc.edu" class="email">lmao@biostat.wisc.edu</a>) &amp; Tuo Wang</h4>
            
      

      <div class="d-none name"><code>PW_reg.Rmd</code></div>
    </div>

    
    
<p>This vignette demonstrates the use of the <code>WR</code> package in
fitting the proportional win-fractions (PW) regression model for
prioritized composite endpoints consisting of death and a nonfatal event
(Mao and Wang, 2020, <em>Biometrics</em>). The PW model can be viewed as
the regression version of the two-sample win ratio proposed by Pocock et
al.¬†(2012).</p>
<div class="section level2">
<h2 id="model-specification">MODEL SPECIFICATION<a class="anchor" aria-label="anchor" href="#model-specification"></a>
</h2>
<p>Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>D</mi><annotation encoding="application/x-tex">D</annotation></semantics></math>
denote the survival time,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math>
time to the first nonfatal event like hospitalization, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùêô</mi><annotation encoding="application/x-tex">\boldsymbol Z</annotation></semantics></math>
a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>-vector
of covariates. The composite outcome is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùêò</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo>,</mo><mi>T</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\boldsymbol Y=(D, T)</annotation></semantics></math>
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>D</mi><annotation encoding="application/x-tex">D</annotation></semantics></math>
prioritized over
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math>.
If the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>th
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>th
patients are both followed up to time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>,
define
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùí≤</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>ùêò</mi><mi>i</mi></msub><mo>,</mo><msub><mi>ùêò</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><mrow><mtext mathvariant="normal">subject </mtext><mspace width="0.333em"></mspace></mrow><mi>i</mi><mrow><mspace width="0.333em"></mspace><mtext mathvariant="normal"> wins against subject </mtext><mspace width="0.333em"></mspace></mrow><mi>j</mi><mrow><mspace width="0.333em"></mspace><mtext mathvariant="normal"> by </mtext><mspace width="0.333em"></mspace></mrow><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>D</mi><mi>j</mi></msub><mo>&lt;</mo><msub><mi>D</mi><mi>i</mi></msub><mo>‚àß</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>D</mi><mi>i</mi></msub><mo>‚àß</mo><msub><mi>D</mi><mi>j</mi></msub><mo>&gt;</mo><mi>t</mi><mo>,</mo><msub><mi>T</mi><mi>j</mi></msub><mo>&lt;</mo><msub><mi>T</mi><mi>i</mi></msub><mo>‚àß</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\mathcal W(\boldsymbol Y_i, \boldsymbol Y_j)(t) = I(\mbox{subject $i$ wins against subject $j$ by $t$}) = I(D_j &lt; D_i \wedge t) + I(D_i \wedge D_j &gt; t, T_j &lt; T_i \wedge t),</annotation></semantics></math>
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>‚àß</mo><mi>b</mi><mo>=</mo><mo>min</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo>,</mo><mi>b</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">a\wedge b=\min(a,b)</annotation></semantics></math>.
This ‚Äò‚Äôwin indicator‚Äô‚Äô uses the sequential comparison rule of Pocock et
al.¬†(2012).</p>
<p>Then, the covariate-specific win ratio at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
is
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mi>R</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>;</mo><msub><mi>ùêô</mi><mi>i</mi></msub><mo>,</mo><msub><mi>ùêô</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>:=</mo><mfrac><mrow><mi>E</mi><mo stretchy="false" form="prefix">{</mo><mi>ùí≤</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>ùêò</mi><mi>i</mi></msub><mo>,</mo><msub><mi>ùêò</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚à£</mo><msub><mi>ùêô</mi><mi>i</mi></msub><mo>,</mo><msub><mi>ùêô</mi><mi>j</mi></msub><mo stretchy="false" form="postfix">}</mo></mrow><mrow><mi>E</mi><mo stretchy="false" form="prefix">{</mo><mi>ùí≤</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>ùêò</mi><mi>j</mi></msub><mo>,</mo><msub><mi>ùêò</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚à£</mo><msub><mi>ùêô</mi><mi>i</mi></msub><mo>,</mo><msub><mi>ùêô</mi><mi>j</mi></msub><mo stretchy="false" form="postfix">}</mo></mrow></mfrac><mi>.</mi></mrow><annotation encoding="application/x-tex">WR(t;\boldsymbol Z_i, \boldsymbol Z_j):=\frac{E\{\mathcal W(\boldsymbol Y_i, \boldsymbol Y_j)(t)\mid \boldsymbol Z_i, \boldsymbol Z_j\}}{E\{\mathcal W(\boldsymbol Y_j, \boldsymbol Y_i)(t)\mid \boldsymbol Z_i, \boldsymbol Z_j\}}.</annotation></semantics></math>
For example, if subject
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
is from the treatment arm with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ùêô</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\boldsymbol Z_i=1</annotation></semantics></math>
and subject
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
is from the treatment arm with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ùêô</mi><mi>j</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\boldsymbol Z_j=0</annotation></semantics></math>,
then
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mi>R</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>;</mo><msub><mi>ùêô</mi><mi>i</mi></msub><mo>,</mo><msub><mi>ùêô</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">WR(t;\boldsymbol Z_i, \boldsymbol Z_j)</annotation></semantics></math>
is precisely the estimand of Pocock‚Äôs win ratio comparing the treatment
to the control when all subjects in both arms are followed to time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>.</p>
<p>The PW model specifies that <span class="math display">$$\mbox{PW
Model: }\hspace{3mm} WR(t;\boldsymbol Z_i, \boldsymbol
Z_j)=\exp\{\boldsymbol\beta^{\rm T}(\boldsymbol Z_i -\boldsymbol
Z_j)\}.$$</span> Clearly, the PW model assumes that win ratio is
invariant to the follow-up time (proportionality assumption). Under the
model, the components of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùõÉ</mi><annotation encoding="application/x-tex">\boldsymbol\beta</annotation></semantics></math>
can be interpreted as the log win ratios associated with unit increases
in the corresponding covariates. Under the PW model, we can obtain
consistent estimates for the parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùõÉ</mi><annotation encoding="application/x-tex">\boldsymbol\beta</annotation></semantics></math>
based on censored data regardless of distribution of the censoring time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>C</mi><annotation encoding="application/x-tex">C</annotation></semantics></math>
as long as
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>C</mi><mo>‚ä•</mo><mi>ùêò</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚à£</mo><mi>ùêô</mi><mi>.</mi></mrow><annotation encoding="application/x-tex">(C\perp \boldsymbol Y)\mid \boldsymbol Z.</annotation></semantics></math></p>
</div>
<div class="section level2">
<h2 id="basic-syntax">BASIC SYNTAX<a class="anchor" aria-label="anchor" href="#basic-syntax"></a>
</h2>
<p>The input data must be in the ‚Äúlong format‚Äù, with an <code>ID</code>
vector containing unique patient-level identifiers. In addition, we need
a <code>time</code> vector containing the event times and a
<code>status</code> vector indicating the corresponding cause of the
event. The vector <code>status</code> should be coded as
<code>1</code>=death; <code>2</code>=non-fatal event;
<code>0</code>=censoring. In the case of recurrent non-fatal event,
multiple rows with <code>status</code>=2 are allowed. However, by nature
of the method, only time to the first episode will be used. Finally, we
need a covariate matrix <code>Z</code> with the same row as
<code>ID</code>. Each column of <code>Z</code> represents a covariate.
All covariates need to be time-constant.</p>
<p>The main function to fit the PW model is
<code>pwreg(time,status, Z, ID)</code>. The function returns an object
of class <code>pwreg</code> with a <code>beta</code> vector for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>ùõÉ</mi><mo accent="true">ÃÇ</mo></mover><annotation encoding="application/x-tex">\widehat{\boldsymbol\beta}</annotation></semantics></math>
and a <code>Var</code> matrix for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">var</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mover><mi>ùõÉ</mi><mo accent="true">ÃÇ</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{var}(\widehat{\boldsymbol\beta})</annotation></semantics></math>.
For details, refer to documentation of the <code>WR</code> package.</p>
</div>
<div class="section level2">
<h2 id="an-example-with-the-hf-action-trial">AN EXAMPLE WITH THE HF-ACTION TRIAL<a class="anchor" aria-label="anchor" href="#an-example-with-the-hf-action-trial"></a>
</h2>
<p>We consider a dataset from the HF-ACTION study consisting of 451
non-ischemic heart failure patients. The study was conducted between
April 2003 through Feb 2007 at 82 sites in the USA, Canada, and France
(O‚ÄôConnor et al., 2009). The study objective was to assess the effect of
adding aerobic exercise training to usual care on the patient‚Äôs CV
outcomes. The primary endpoint was a composite of all-cause death and
all-cause hospitalization.</p>
<p>We first load the <code>WR</code> package and the analysis dataset
<code>non_ischemic</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sites.google.com/view/lmaowisc/" class="external-link">WR</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">non_ischemic</span><span class="op">)</span></span>
<span><span class="co">#&gt;   ID time status trt_ab age sex Black.vs.White Other.vs.White   bmi bipllvef</span></span>
<span><span class="co">#&gt; 1  1  221      2      0  62   1              0              0 25.18    32.24</span></span>
<span><span class="co">#&gt; 2  1  383      0      0  62   1              0              0 25.18    32.24</span></span>
<span><span class="co">#&gt; 3  2   23      2      0  75   1              1              0 22.96    21.71</span></span>
<span><span class="co">#&gt; 4  2 1400      0      0  75   1              1              0 22.96    21.71</span></span>
<span><span class="co">#&gt; 5  5    7      2      0  48   1              1              0 34.37    22.97</span></span>
<span><span class="co">#&gt; 6  5   10      1      0  48   1              1              0 34.37    22.97</span></span>
<span><span class="co">#&gt;   hyperten COPD diabetes acei betab smokecurr</span></span>
<span><span class="co">#&gt; 1        0    0        0    0     1         1</span></span>
<span><span class="co">#&gt; 2        0    0        0    0     1         1</span></span>
<span><span class="co">#&gt; 3        1    0        0    0     1         0</span></span>
<span><span class="co">#&gt; 4        1    0        0    0     1         0</span></span>
<span><span class="co">#&gt; 5        1    0        0    0     1         0</span></span>
<span><span class="co">#&gt; 6        1    0        0    0     1         0</span></span></code></pre></div>
<p>We re-label the covariates with informative names.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">non_ischemic</span><span class="op">)</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">16</span><span class="op">]</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"Training vs Usual"</span>,<span class="st">"Age (year)"</span>,<span class="st">"Male vs Female"</span>,<span class="st">"Black vs White"</span>, </span>
<span>  <span class="st">"Other vs White"</span>, <span class="st">"BMI"</span>,<span class="st">"LVEF"</span>,<span class="st">"Hypertension"</span>,<span class="st">"COPD"</span>,<span class="st">"Diabetes"</span>,</span>
<span>  <span class="st">"ACE Inhibitor"</span>,<span class="st">"Beta Blocker"</span>, <span class="st">"Smoker"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Compute the sample size the median length of follow-up.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># sample size</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">non_ischemic</span><span class="op">$</span><span class="va">ID</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 451</span></span>
<span><span class="co"># median length of follow-up time</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">non_ischemic</span><span class="op">$</span><span class="va">time</span><span class="op">[</span><span class="va">non_ischemic</span><span class="op">$</span><span class="va">status</span><span class="op">&lt;</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="fl">30.5</span></span>
<span><span class="co">#&gt; [1] 31.63934</span></span></code></pre></div>
<p>So we indeed have
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mn>451</mn></mrow><annotation encoding="application/x-tex">n=451</annotation></semantics></math>
unique patients with a median follow-up of 31.6 months.</p>
<p>Next, we use the <code><a href="../reference/pwreg.html">pwreg()</a></code> function to fit the PW
model:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get the number of rows and number of covariates.</span></span>
<span><span class="va">nr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">non_ischemic</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">non_ischemic</span><span class="op">)</span><span class="op">-</span><span class="fl">3</span></span>
<span></span>
<span><span class="co"># extract ID, time, status and covariates matrix Z from the data.</span></span>
<span><span class="co"># note that: ID, time and status should be column vector.</span></span>
<span><span class="co"># covariatesZ should be (nr, p) matrix.</span></span>
<span><span class="va">ID</span> <span class="op">&lt;-</span> <span class="va">non_ischemic</span><span class="op">[</span>,<span class="st">"ID"</span><span class="op">]</span></span>
<span><span class="va">time</span> <span class="op">&lt;-</span> <span class="va">non_ischemic</span><span class="op">[</span>,<span class="st">"time"</span><span class="op">]</span></span>
<span><span class="va">status</span> <span class="op">&lt;-</span> <span class="va">non_ischemic</span><span class="op">[</span>,<span class="st">"status"</span><span class="op">]</span></span>
<span><span class="va">Z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">non_ischemic</span><span class="op">[</span>,<span class="fl">4</span><span class="op">:</span><span class="op">(</span><span class="fl">3</span><span class="op">+</span><span class="va">p</span><span class="op">)</span><span class="op">]</span>,<span class="va">nr</span>,<span class="va">p</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># pass the parameters into the function</span></span>
<span><span class="va">pwreg.obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pwreg.html">pwreg</a></span><span class="op">(</span>time<span class="op">=</span><span class="va">time</span>,status<span class="op">=</span><span class="va">status</span>,Z<span class="op">=</span><span class="va">Z</span>,ID<span class="op">=</span><span class="va">ID</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">pwreg.obj</span><span class="op">)</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; pwreg(ID = ID, time = time, status = status, Z = Z)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Proportional win-fractions regression models for priority-adjusted composite endpoint</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     (Mao and Wang, 2020):</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Total number of pairs: 101475 </span></span>
<span><span class="co">#&gt; Wins-losses on death:  7644 (7.5%) </span></span>
<span><span class="co">#&gt; Wins-losses on non-fatal event:  78387 (77.2%) </span></span>
<span><span class="co">#&gt; Indeterminate pairs 15444 (15.2%) </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Newton-Raphson algorithm converged in 5 iterations.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Overall test: chisq test with 13 degrees of freedom; </span></span>
<span><span class="co">#&gt;  Wald statistic 24.9 with p-value 0.02392931 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimates for Regression parameters:</span></span>
<span><span class="co">#&gt;                     Estimate         se z.value p.value  </span></span>
<span><span class="co">#&gt; Training vs Usual  0.1906687  0.1264658  1.5077 0.13164  </span></span>
<span><span class="co">#&gt; Age (year)        -0.0128306  0.0057285 -2.2398 0.02510 *</span></span>
<span><span class="co">#&gt; Male vs Female    -0.1552923  0.1294198 -1.1999 0.23017  </span></span>
<span><span class="co">#&gt; Black vs White    -0.3026335  0.1461330 -2.0709 0.03836 *</span></span>
<span><span class="co">#&gt; Other vs White    -0.3565390  0.3424360 -1.0412 0.29779  </span></span>
<span><span class="co">#&gt; BMI               -0.0181310  0.0097582 -1.8580 0.06316 .</span></span>
<span><span class="co">#&gt; LVEF               0.0214905  0.0086449  2.4859 0.01292 *</span></span>
<span><span class="co">#&gt; Hypertension      -0.0318291  0.1456217 -0.2186 0.82698  </span></span>
<span><span class="co">#&gt; COPD              -0.4023069  0.2066821 -1.9465 0.05159 .</span></span>
<span><span class="co">#&gt; Diabetes           0.0703990  0.1419998  0.4958 0.62006  </span></span>
<span><span class="co">#&gt; ACE Inhibitor     -0.1068201  0.1571317 -0.6798 0.49662  </span></span>
<span><span class="co">#&gt; Beta Blocker      -0.5344979  0.3289319 -1.6250 0.10417  </span></span>
<span><span class="co">#&gt; Smoker            -0.0602350  0.1682826 -0.3579 0.72039  </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Point and interval estimates for the win ratios:</span></span>
<span><span class="co">#&gt;                   Win Ratio 95% lower CL 95% higher CL</span></span>
<span><span class="co">#&gt; Training vs Usual 1.2100585    0.9444056     1.5504374</span></span>
<span><span class="co">#&gt; Age (year)        0.9872513    0.9762288     0.9983983</span></span>
<span><span class="co">#&gt; Male vs Female    0.8561648    0.6643471     1.1033663</span></span>
<span><span class="co">#&gt; Black vs White    0.7388699    0.5548548     0.9839127</span></span>
<span><span class="co">#&gt; Other vs White    0.7000951    0.3578286     1.3697431</span></span>
<span><span class="co">#&gt; BMI               0.9820323    0.9634287     1.0009952</span></span>
<span><span class="co">#&gt; LVEF              1.0217231    1.0045572     1.0391823</span></span>
<span><span class="co">#&gt; Hypertension      0.9686721    0.7281543     1.2886357</span></span>
<span><span class="co">#&gt; COPD              0.6687755    0.4460178     1.0027865</span></span>
<span><span class="co">#&gt; Diabetes          1.0729362    0.8122757     1.4172433</span></span>
<span><span class="co">#&gt; ACE Inhibitor     0.8986873    0.6604773     1.2228110</span></span>
<span><span class="co">#&gt; Beta Blocker      0.5859634    0.3075270     1.1164977</span></span>
<span><span class="co">#&gt; Smoker            0.9415433    0.6770144     1.3094312</span></span></code></pre></div>
<p>The output consists of three parts. The first part presents some
descriptive statistics on the proportions of win-loss status among all
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mfrac linethickness="0"><mi>n</mi><mn>2</mn></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>101</mn><mo>,</mo><mn>475</mn></mrow><annotation encoding="application/x-tex">{n\choose 2}=101,475</annotation></semantics></math>
pairs. According to the output,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>7.5</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">7.5\%</annotation></semantics></math>
of them are determined by death;
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>77.2</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">77.2\%</annotation></semantics></math>
by hospitalization, and the remaining
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>7.2</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">7.2\%</annotation></semantics></math>
are indeterminate. It also reports an overall (Wald) test with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>-value
0.024, suggesting that, at the conventional 0.05 level, the 13
covariates are significantly associated with the composite outcome.</p>
<p>The second part presents a table for the estimates and standard
errors of the regression coefficient, along with their corresponding
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>-value
for testing the coefficient being zero. The third part is perhaps the
most informative, tabulating the estimated win ratios (exponential of
the regression coefficients) and their associated
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>95</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">95\%</annotation></semantics></math>
confidence intervals. We can see that a patient in exercise training is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>21</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">21\%</annotation></semantics></math>
more likely to have a better priority-adjusted composite outcome than
one in usual care. However, this difference is statistically not
significant. In addition, younger age, white race, higher LVEF are
significantly associated with more favorable outcomes than otherwise,
while the beneficial effects of low BMI and absence of COPD history are
border-line significant.</p>
<p>To assess the effect of race on the composite outcome, we test the
null hypothesis
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mn>0</mn></msub><mo>:</mo><msub><mi>Œ≤</mi><mn>4</mn></msub><mo>=</mo><msub><mi>Œ≤</mi><mn>5</mn></msub><mo>=</mo><mn>0</mn><mi>.</mi></mrow><annotation encoding="application/x-tex">H_0:\beta_4=\beta_5=0.</annotation></semantics></math>
We conduct a 2-df Chi-square Wald test based on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>Œ≤</mi><mo accent="true">ÃÇ</mo></mover><mn>4</mn></msub><mo>,</mo><msub><mover><mi>Œ≤</mi><mo accent="true">ÃÇ</mo></mover><mn>5</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>T</mi></msup><annotation encoding="application/x-tex">(\widehat\beta_4,\widehat\beta_5)^{T}</annotation></semantics></math>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#extract estimates of (\beta_4,\beta_5)</span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">pwreg.obj</span><span class="op">$</span><span class="va">beta</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#extract estimated covariance matrix for (\beta_4,\beta_5)</span></span>
<span><span class="va">Sigma</span> <span class="op">&lt;-</span> <span class="va">pwreg.obj</span><span class="op">$</span><span class="va">Var</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">4</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#compute chisq statistic in quadratic form</span></span>
<span><span class="va">chistats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">Sigma</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta</span>  </span>
<span></span>
<span><span class="co">#compare the Wald statistic with the reference</span></span>
<span><span class="co"># distribution of chisq(2) to obtain the p-value</span></span>
<span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html" class="external-link">pchisq</a></span><span class="op">(</span><span class="va">chistats</span>, df<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt;           [,1]</span></span>
<span><span class="co">#&gt; [1,] 0.1016988</span></span></code></pre></div>
<p>The
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>-value
is 0.102. So the overall effect of race on the composite outcome is
non-significant.</p>
<p>Finally, we use the <code><a href="../reference/score.proc.html">score.proc()</a></code> function to plot the
standardized score process for each covariate:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">score.obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/score.proc.html">score.proc</a></span><span class="op">(</span><span class="va">pwreg.obj</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">score.obj</span><span class="op">)</span></span>
<span><span class="co">#&gt; This object contains two components:</span></span>
<span><span class="co">#&gt;  't': an l-vector of times</span></span>
<span><span class="co">#&gt;  'score': a p-by-l matrix whose k'th row is the standardized score process for the k'th covariate</span></span>
<span><span class="co">#&gt;           as a function of t</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Use 'plot(object,k=k)' to plot the k'th score process.</span></span>
<span></span>
<span><span class="va">oldpar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="st">"mfrow"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">13</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">score.obj</span>, k <span class="op">=</span> <span class="va">i</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">oldpar</span><span class="op">)</span></span></code></pre></div>
<p><img src="PW_reg_files/figure-html/unnamed-chunk-6-1.png" width="720"></p>
<p>Most curves are fairly patternless with suprema well bounded by 2. So
we conclude that the proportionality assumption approximately holds.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li><p>Mao, L. and Wang, T. (2020). A class of proportional
win-fractions regression models for composite outcomes.
<em>Biometrics</em>, <a href="https://doi.org/10.1111/biom.13382" class="external-link uri">https://doi.org/10.1111/biom.13382</a>.</p></li>
<li><p>O‚ÄôConnor, C. M., Whellan, D. J., Lee, K. L., Keteyian, S. J.,
Cooper, L. S., Ellis, S. J., Leifer, E. S., Kraus, W. E., Kitzman, D.
W., Blumenthal, J. A. et al.¬†(2009). Efficacy and safety of exercise
training in patients with chronic heart failure: HF-ACTION randomized
controlled trial. <em>Journal of the American Medical Association</em>,
301, 1439‚Äì1450.</p></li>
<li><p>Pocock, S., Ariti, C., Collier, T., and Wang, D. (2012). The win
ratio: a new approach to the analysis of composite endpoints in clinical
trials based on clinical priorities. <em>European Heart Journal</em>,
33, 176‚Äì182.</p></li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Lu Mao.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
