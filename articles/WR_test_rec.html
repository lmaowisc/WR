<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Two-sample win ratio tests of possibly recurrent event and death ‚Ä¢ WR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Two-sample win ratio tests of possibly recurrent event and death">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">WR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/PW_reg.html">Proportional win-fractions (PW) regression of composite endpoints of death and nonfatal event</a></li>
    <li><a class="dropdown-item" href="../articles/PW_stratify_reg.html">Stratified proportional win-fractions (PW) regression of composite endpoints of death and nonfatal event</a></li>
    <li><a class="dropdown-item" href="../articles/WR_sample_size.html">Sample size calculation for standard win ratio test</a></li>
    <li><a class="dropdown-item" href="../articles/WR_test_rec.html">Two-sample win ratio tests of possibly recurrent event and death</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Two-sample win ratio tests of possibly recurrent event and death</h1>
                        <h4 data-toc-skip class="author">Lu Mao (<a href="mailto:lmao@biostat.wisc.edu" class="email">lmao@biostat.wisc.edu</a>)</h4>
            
      

      <div class="d-none name"><code>WR_test_rec.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">INTRODUCTION<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette demonstrates the use of the <code>WR</code> package for
two-sample win ratio tests of recurrent event and death (Mao et al.,
2022).</p>
<div class="section level3">
<h3 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h3>
<p>Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>D</mi><annotation encoding="application/x-tex">D</annotation></semantics></math>
denote the survival time and write
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mi>D</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo>‚â§</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">N_D(t)=I(D\leq t)</annotation></semantics></math>.
Likewise, let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mn>1</mn></msub><mo>&lt;</mo><msub><mi>T</mi><mn>2</mn></msub><mo>&lt;</mo><mi>‚ãØ</mi></mrow><annotation encoding="application/x-tex">T_1&lt;T_2&lt;\cdots</annotation></semantics></math>
denote the recurrent event times and write
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mi>H</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msubsup><mo>‚àë</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>‚àû</mi></msubsup><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>T</mi><mi>k</mi></msub><mo>‚â§</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">N_H(t)=\sum_{k=1}^\infty I(T_k\leq t)</annotation></semantics></math>.
In other words,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mi>H</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">N_H(t)</annotation></semantics></math>
is the counting process for the recurrent event. Since death is a
terminal event, we must have that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mi>H</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>N</mi><mi>H</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>‚àß</mo><mi>D</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">N_H(t)=N_H(t\wedge D)</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mo>‚àß</mo><mi>c</mi><mo>=</mo><mo>min</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>b</mi><mo>,</mo><mi>c</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">b\wedge c=\min(b,c)</annotation></semantics></math>.
Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùêò</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo stretchy="false" form="prefix">{</mo><msub><mi>N</mi><mi>D</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><msub><mi>N</mi><mi>H</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>:</mo><mn>0</mn><mo>‚â§</mo><mi>u</mi><mo>‚â§</mo><mi>t</mi><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\boldsymbol Y(t)=\{N_D(u), N_H(u):0\leq u\leq t\}</annotation></semantics></math>
denote the event history up to time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>.
The full outcome data without censoring are thus
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùêò</mi><mo>:=</mo><mi>ùêò</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>œÑ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\boldsymbol Y:=\boldsymbol Y(\tau)</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>œÑ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
is the maximum length of follow-up.</p>
</div>
<div class="section level3">
<h3 id="general-framework-for-hypotheses-and-tests">General framework for hypotheses and tests<a class="anchor" aria-label="anchor" href="#general-framework-for-hypotheses-and-tests"></a>
</h3>
<p>Use
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">a=1</annotation></semantics></math>
to denote the active treatment and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">a=0</annotation></semantics></math>
to denote the control. For all notation introduced above, use the
subscript
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(a)</annotation></semantics></math>
to denote the corresponding group-specific quantity. For example,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>ùêò</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">\boldsymbol Y^{(a)}</annotation></semantics></math>
represents the outcome data from group
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>a</mi><annotation encoding="application/x-tex">a</annotation></semantics></math><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo>=</mo><mn>1</mn><mo>,</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(a=1, 0)</annotation></semantics></math>.
Consider a time-dependent win function of the form
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùí≤</mi><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>ùêò</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>,</mo><msup><mi>ùêò</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>‚àí</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><mrow><mtext mathvariant="normal">patient in group </mtext><mspace width="0.333em"></mspace></mrow><mi>a</mi><mrow><mspace width="0.333em"></mspace><mtext mathvariant="normal"> wins against that in group </mtext><mspace width="0.333em"></mspace></mrow><mrow><mn>1</mn><mo>‚àí</mo><mi>a</mi></mrow><mrow><mspace width="0.333em"></mspace><mtext mathvariant="normal"> by
time </mtext><mspace width="0.333em"></mspace></mrow><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">\mathcal W(\boldsymbol Y^{(a)}, \boldsymbol Y^{(1-a)})(t) 
= I(\mbox{patient in group $a$ wins against that in group $1-a$ by
time $t$}).</annotation></semantics></math> The specific definition of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùí≤</mi><annotation encoding="application/x-tex">\mathcal W</annotation></semantics></math>
will be discussed later.</p>
<p>Given such a rule of cross-group comparison, the win and loss
probabilities for the treatment against control by time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
are
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>E</mi><mo stretchy="false" form="prefix">{</mo><mi>ùí≤</mi><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>ùêò</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>,</mo><msup><mi>ùêò</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">w(t)=E\{\mathcal W(\boldsymbol Y^{(1)}, \boldsymbol Y^{(0)})(t)\}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>E</mi><mo stretchy="false" form="prefix">{</mo><mi>ùí≤</mi><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>ùêò</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>,</mo><msup><mi>ùêò</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">l(t)=E\{\mathcal W(\boldsymbol Y^{(0)}, \boldsymbol Y^{(0)})(t)\}</annotation></semantics></math>,
respectively. Suppose that we wish to test the null hypothesis that the
win and loss probabilities are equal, i.e., <span class="math display">$$H_0: w(t)=l(t)\hspace{2ex}\mbox{for all }t\in[0,
\tau],$$</span> against the alternative hypothesis that the win
probability dominates the loss probability, i.e., <span class="math display">$$\begin{equation}\tag{1}
H_A: w(t)\geq l(t)\hspace{1ex}\mbox{for all }t\in[0, \tau]
\mbox{ with strict inequality for some }t.
\end{equation}$$</span> With censored data, a general way to test such
hypotheses is to use a log-transformed two-sample win ratio constructed
similarly to Pocock et al.¬†(2012), only with the pairwise rule of
comparison replaced by the customized
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùí≤</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>‚ãÖ</mo><mo>,</mo><mo>‚ãÖ</mo><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal W(\cdot,\cdot)(t)</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
is set as the earlier of the two observed follow-up times. A stratified
test can also be developed along the lines of Dong et al.¬†(2018).</p>
</div>
<div class="section level3">
<h3 id="choice-of-win-function">Choice of win function<a class="anchor" aria-label="anchor" href="#choice-of-win-function"></a>
</h3>
<p>Different choices of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùí≤</mi><annotation encoding="application/x-tex">\mathcal W</annotation></semantics></math>
will lead to different hypotheses and tests. The standard win ratio
(SWR) of Pocock et al.¬†(2012) corresponds to the choice of
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ùí≤</mi><mi>S</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>ùêò</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>,</mo><msup><mi>ùêò</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>‚àí</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>D</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>‚àí</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>&lt;</mo><msup><mi>D</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>‚àß</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>D</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>‚àß</mo><msup><mi>D</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>‚àí</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>&gt;</mo><mi>t</mi><mo>,</mo><msubsup><mi>T</mi><mn>1</mn><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>‚àí</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo>&lt;</mo><msubsup><mi>T</mi><mn>1</mn><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo>‚àß</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">\mathcal W_S(\boldsymbol Y^{(a)}, \boldsymbol Y^{(1-a)})(t)
=I(D^{(1-a)}&lt;D^{(a)}\wedge t)+I(D^{(a)}\wedge D^{(1-a)}&gt;t, T_1^{(1-a)}&lt;T_1^{(a)}\wedge t).</annotation></semantics></math>
With recurrent nonfatal event,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ùí≤</mi><mi>S</mi></msub><annotation encoding="application/x-tex">\mathcal W_S</annotation></semantics></math>
fails to fully exploit the data as it draws only on the first
occurrence. A more efficient rule is given by the last-event-assisted
win ratio (LWR), which compares on the nonfatal event first by its
cumulative frequency, with ties broken by the time of its last episode.
In other words, <span class="math display">$$\begin{align}
\mathcal W_L(\boldsymbol Y^{(a)}, \boldsymbol Y^{(1-a)})(t)
&amp;=I(D^{(1-a)}&lt;D^{(a)}\wedge t)+I\{D^{(a)}\wedge D^{(1-a)}&gt;t,
N_H^{(a)}(t)&lt;N_H^{(1-a)}(t)\}\\
&amp;\hspace{1ex}+I\{D^{(a)}\wedge D^{(1-a)}&gt;t,
N_H^{(a)}(t)=N_H^{(1-a)}(t)=\mbox{ some } k,
T_k^{(1-a)}&lt;T_k^{(a)}\}.
\end{align}$$</span> Likewise we can construct a first-event-assisted
win ratio (FWR) by replacing the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>T</mi><mi>k</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><annotation encoding="application/x-tex">T_k^{(a)}</annotation></semantics></math>
with the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>T</mi><mn>1</mn><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><annotation encoding="application/x-tex">T_1^{(a)}</annotation></semantics></math>,
or a naive win ratio (NWR) by removing the tie-breaking third term
altogether (see Mao et al.¬†(2022) for details). Nonetheless, it is
recommended that the LWR be used as the default, as it makes fuller use
of the data and reduces to the SWR when the nonfatal event occurs at
most once.</p>
<p>Under the LWR, a simple condition that implies the dominance of win
probability in (1) is a joint stochastic order of the event times
between the two groups:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>D</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>&gt;</mo><mi>s</mi><mo>,</mo><msubsup><mi>T</mi><mn>1</mn><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo>&gt;</mo><msub><mi>t</mi><mn>1</mn></msub><mo>,</mo><msubsup><mi>T</mi><mn>2</mn><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo>&gt;</mo><msub><mi>t</mi><mn>2</mn></msub><mo>,</mo><mi>‚Ä¶</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>&gt;</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>D</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>&gt;</mo><mi>s</mi><mo>,</mo><msubsup><mi>T</mi><mn>1</mn><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo>&gt;</mo><msub><mi>t</mi><mn>1</mn></msub><mo>,</mo><msubsup><mi>T</mi><mn>2</mn><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo>&gt;</mo><msub><mi>t</mi><mn>2</mn></msub><mo>,</mo><mi>‚Ä¶</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\begin{equation}\tag{2}
{P}(D^{(1)}&gt;s, T^{(1)}_{1}&gt;t_1, T^{(1)}_{2}&gt;t_2, \ldots)&gt;
{P}(D^{(0)}&gt;s, T^{(0)}_{1}&gt;t_1, T^{(0)}_{2}&gt;t_2, \ldots),
\end{equation}</annotation></semantics></math> for all
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mo>‚â§</mo><msub><mi>t</mi><mn>1</mn></msub><mo>‚â§</mo><msub><mi>t</mi><mn>2</mn></msub><mo>‚â§</mo><mi>‚ãØ</mi><mo>‚â§</mo><mi>s</mi><mo>‚â§</mo><mi>œÑ</mi></mrow><annotation encoding="application/x-tex">0\leq t_1\leq t_2\leq\cdots\leq s\leq\tau</annotation></semantics></math>.
Expression (2) means that the treatment stochastically delays all
events, fatal and nonfatal, jointly as compared to the control. Hence,
when (2) is true, the LWR test rejects
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>0</mn></msub><annotation encoding="application/x-tex">H_0</annotation></semantics></math>
with probability tending to 1 as the sample size increases to
infinity.</p>
</div>
</div>
<div class="section level2">
<h2 id="basic-syntax">BASIC SYNTAX<a class="anchor" aria-label="anchor" href="#basic-syntax"></a>
</h2>
<p>The basic function to perform the win ratio tests is
<code><a href="../reference/WRrec.html">WRrec()</a></code>. To use the function, the input data must be in the
‚Äúlong‚Äù format. Specifically, we need an <code>ID</code> variable
containing the unique patient identifiers, a <code>time</code> variable
containing the event times, a <code>status</code> variable labeling the
event type (<code>status=2</code> for recurrent non-fatal event,
<code>=1</code> for death, and <code>=0</code> for censoring), and,
finally, a binary <code>trt</code> variable with 1 indicating the
treatment and 0 indicating the control. To perform an unstratified LWR
test, use</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obj</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/WRrec.html">WRrec</a></span><span class="op">(</span><span class="va">ID</span>,<span class="va">time</span>,<span class="va">status</span>,<span class="va">trt</span><span class="op">)</span></span></code></pre></div>
<p>For a stratified test, supply a vector of stratifying (categorical)
variable through an additional <code>strata=</code> argument. To get
test results from FWR and NWR as well, add the option
<code>naive=TRUE</code>. Printing the object <code>obj</code> gives us
the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>-values
of the tests as well as some descriptive statistics.</p>
</div>
<div class="section level2">
<h2 id="an-example-with-the-hf-action-trial">AN EXAMPLE WITH THE HF-ACTION TRIAL<a class="anchor" aria-label="anchor" href="#an-example-with-the-hf-action-trial"></a>
</h2>
<div class="section level3">
<h3 id="data-description">Data description<a class="anchor" aria-label="anchor" href="#data-description"></a>
</h3>
<p>To illustrate the win ratio tests, consider the Heart Failure: A
Controlled Trial Investigating Outcomes of Exercise Training (HF-ACTION)
trial. A randomized controlled trial, HF-ACTION was conducted on a
cohort of over two thousand heart failure patients recruited between
2003‚Äì2007 across the USA, Canada, and France (O‚ÄôConnor et al., 2009).
The study aimed to assess the effect of adding aerobic exercise training
to usual care on the patient‚Äôs composite endpoint of all-cause death and
all-cause hospitalization. The primary analysis of the whole study
population showed a moderate and non-significant reduction in the risk
of time to the first composite event (hazard ratio 0.93;
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>-value
0.13). Here we focus on a subgroup of non-ischemic patients with reduced
cardio-pulmonary exercise (CPX) test duration (i.e.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>‚â§</mo><mn>9</mn></mrow><annotation encoding="application/x-tex">\leq 9</annotation></semantics></math>
minutes before reporting of discomfort). There are scientific and
empirical evidence suggesting that this particular sub-population may
benefit more from exercise training interventions than does the average
heart failure patient.</p>
<p>The associated dataset <code>hfaction_cpx9</code> is contained in the
<code>WR</code> package and can be loaded by</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sites.google.com/view/lmaowisc/" class="external-link">WR</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hfaction_cpx9</span><span class="op">)</span></span>
<span><span class="co">#&gt;        patid       time status trt_ab age60</span></span>
<span><span class="co">#&gt; 1 HFACT00001  7.2459016      2      0     1</span></span>
<span><span class="co">#&gt; 2 HFACT00001 12.5573770      0      0     1</span></span>
<span><span class="co">#&gt; 3 HFACT00002  0.7540984      2      0     1</span></span>
<span><span class="co">#&gt; 4 HFACT00002  4.2950820      2      0     1</span></span>
<span><span class="co">#&gt; 5 HFACT00002  4.7540984      2      0     1</span></span>
<span><span class="co">#&gt; 6 HFACT00002 45.9016393      0      0     1</span></span></code></pre></div>
<p>The dataset is already in a format suitable for <code><a href="../reference/WRrec.html">WRrec()</a></code>
(<code>status</code>= 2 for hospitalization and = 1 for death). The
<code>time</code> variable is in units of months and <code>trt=0</code>
for usual care (control) and <code>1</code> for exercise training. The
<code>age60</code> variable is an indicator of patient age being greater
than or equal to 60 years and can potentially serve as a stratifying
variable.</p>
</div>
<div class="section level3">
<h3 id="win-ratio-tests-on-recurrent-event-and-death">Win ratio tests on recurrent event and death<a class="anchor" aria-label="anchor" href="#win-ratio-tests-on-recurrent-event-and-death"></a>
</h3>
<p>To perform the win ratio tests between exercise training and usual
care stratified by age, use the code</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## simplify the dataset name</span></span>
<span><span class="va">dat</span><span class="op">&lt;-</span><span class="va">hfaction_cpx9</span></span>
<span><span class="co">## comparing exercise training to usual care by LWR, FWR, and NWR</span></span>
<span><span class="va">obj</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/WRrec.html">WRrec</a></span><span class="op">(</span>ID<span class="op">=</span><span class="va">dat</span><span class="op">$</span><span class="va">patid</span>,time<span class="op">=</span><span class="va">dat</span><span class="op">$</span><span class="va">time</span>,status<span class="op">=</span><span class="va">dat</span><span class="op">$</span><span class="va">status</span>,</span>
<span>          trt<span class="op">=</span><span class="va">dat</span><span class="op">$</span><span class="va">trt_ab</span>,strata<span class="op">=</span><span class="va">dat</span><span class="op">$</span><span class="va">age60</span>,naive<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">## print the results</span></span>
<span><span class="va">obj</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; WRrec(ID = dat$patid, time = dat$time, status = dat$status, trt = dat$trt_ab, </span></span>
<span><span class="co">#&gt;     strata = dat$age60, naive = TRUE)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;             N Rec. Event Death Med. Follow-up</span></span>
<span><span class="co">#&gt; Control   221        571    57       28.62295</span></span>
<span><span class="co">#&gt; Treatment 205        451    36       27.57377</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Analysis of last-event-assisted WR (LWR; recommended), first-event-assisted WR (FWR), and naive WR (NWR):</span></span>
<span><span class="co">#&gt;     Win prob Loss prob WR (95% CI)*      p-value</span></span>
<span><span class="co">#&gt; LWR 50.4%    38.2%     1.32 (1.05, 1.66) 0.0189 </span></span>
<span><span class="co">#&gt; FWR 50.4%    38.3%     1.32 (1.04, 1.66) 0.0202 </span></span>
<span><span class="co">#&gt; NWR 47%      35%       1.34 (1.05, 1.72) 0.0193 </span></span>
<span><span class="co">#&gt; -----</span></span>
<span><span class="co">#&gt; *Note: The scale of WR should be interpreted with caution as it depends on </span></span>
<span><span class="co">#&gt; censoring distribution without modeling assumptions.</span></span></code></pre></div>
<p>We can see from the output above that 57 (25.8%) out of 221 patients
died in usual care, with an average of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>571</mn><mi>/</mi><mn>221</mn><mo>=</mo><mn>2.6</mn></mrow><annotation encoding="application/x-tex">571/221=2.6</annotation></semantics></math>
hospitalizations per patient; and that 36 (17.6%) out of 205 patients
died in exercise training with an average of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>451</mn><mi>/</mi><mn>205</mn><mo>=</mo><mn>2.2</mn></mrow><annotation encoding="application/x-tex">451/205=2.2</annotation></semantics></math>
hospitalizations per patient. Clearly, those undergoing exercise
training are doing much better in terms of both overall survival and
recurrent hospitalization.</p>
<p>Following the descriptive statistics are the analysis results by the
LWR, FWR, and NWR. Although estimates of overall win and loss
probabilities, as well as the win ratio, are provided, their magnitudes
are generally dependent on the censoring distribution and should thus be
interpreted with caution. On the other hand, the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>-values
are from valid tests of the null and alternative hypotheses discussed in
the earlier section. We can see that all three tests yield
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>-values
less than the conventional threshold 0.05, suggesting that exercise
training significantly reduces mortality and recurrent
hospitalization.</p>
</div>
<div class="section level3">
<h3 id="comparison-with-standard-win-ratio">Comparison with standard win ratio<a class="anchor" aria-label="anchor" href="#comparison-with-standard-win-ratio"></a>
</h3>
<p>To compare with the SWR, we first create a dataset where only the
first hospitalization is retained.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">######################################</span></span>
<span><span class="co">## Remove recurrent hospitalization ##</span></span>
<span><span class="co">######################################</span></span>
<span><span class="co">## sort dataset by patid and time</span></span>
<span><span class="va">o</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">patid</span>,<span class="va">dat</span><span class="op">$</span><span class="va">time</span><span class="op">)</span></span>
<span><span class="va">dat</span><span class="op">&lt;-</span><span class="va">dat</span><span class="op">[</span><span class="va">o</span>,<span class="op">]</span></span>
<span><span class="co">## retain only the first hospitalization</span></span>
<span><span class="va">datHF</span><span class="op">&lt;-</span><span class="va">dat</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">dat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"patid"</span>,<span class="st">"status"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">datHF</span><span class="op">)</span></span>
<span><span class="co">#&gt;         patid       time status trt_ab age60</span></span>
<span><span class="co">#&gt; 1  HFACT00001  7.2459016      2      0     1</span></span>
<span><span class="co">#&gt; 2  HFACT00001 12.5573770      0      0     1</span></span>
<span><span class="co">#&gt; 3  HFACT00002  0.7540984      2      0     1</span></span>
<span><span class="co">#&gt; 6  HFACT00002 45.9016393      0      0     1</span></span>
<span><span class="co">#&gt; 7  HFACT00007  3.4754098      2      1     1</span></span>
<span><span class="co">#&gt; 11 HFACT00007 34.8852459      1      1     1</span></span></code></pre></div>
<p>Then we perform the SWR test by applying the same procedure for the
LWR to the reduced dataset (which in this case is equivalent to the
SWR).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Perform the standard win ratio test</span></span>
<span><span class="va">objSWR</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/WRrec.html">WRrec</a></span><span class="op">(</span>ID<span class="op">=</span><span class="va">datHF</span><span class="op">$</span><span class="va">patid</span>,time<span class="op">=</span><span class="va">datHF</span><span class="op">$</span><span class="va">time</span>,status<span class="op">=</span><span class="va">datHF</span><span class="op">$</span><span class="va">status</span>,</span>
<span>          trt<span class="op">=</span><span class="va">datHF</span><span class="op">$</span><span class="va">trt_ab</span>,strata<span class="op">=</span><span class="va">datHF</span><span class="op">$</span><span class="va">age60</span><span class="op">)</span></span>
<span><span class="co">## print the results</span></span>
<span><span class="va">objSWR</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; WRrec(ID = datHF$patid, time = datHF$time, status = datHF$status, </span></span>
<span><span class="co">#&gt;     trt = datHF$trt_ab, strata = datHF$age60)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;             N Rec. Event Death Med. Follow-up</span></span>
<span><span class="co">#&gt; Control   221        170    57       28.62295</span></span>
<span><span class="co">#&gt; Treatment 205        145    36       27.57377</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Analysis of last-event-assisted WR (LWR):</span></span>
<span><span class="co">#&gt;     Win prob Loss prob WR (95% CI)*  p-value</span></span>
<span><span class="co">#&gt; LWR 49.5%    39.1%     1.27 (1, 1.6) 0.0494 </span></span>
<span><span class="co">#&gt; -----</span></span>
<span><span class="co">#&gt; *Note: The scale of WR should be interpreted with caution as it depends on </span></span>
<span><span class="co">#&gt; censoring distribution without modeling assumptions.</span></span></code></pre></div>
<p>We can see that the test result is only borderline significant,
possibly due to less efficient use of the recurrent-event data.</p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li><p>Dong, G., Qiu, J., Wang, D., &amp; Vandemeulebroecke, M. (2018).
The stratified win ratio. <em>Journal of Biopharmaceutical
Statistics</em>, 28, 778‚Äì796.</p></li>
<li><p>Mao, L., Kim, K., &amp; Li, Y. (2022). On recurrent-event win
ratio. <em>Statistical Methods in Medical Research</em>, under
review.</p></li>
<li><p>O‚ÄôConnor, C. M., Whellan, D. J., Lee, K. L., Keteyian, S. J.,
Cooper, L. S., Ellis, S. J., Leifer, E. S., Kraus, W. E., Kitzman, D.
W., Blumenthal, J. A. et al.¬†(2009). ‚ÄúEfficacy and safety of exercise
training in patients with chronic heart failure: HF-ACTION randomized
controlled trial‚Äù. <em>Journal of the American Medical Association</em>,
301, 1439‚Äì1450.</p></li>
<li><p>Pocock, S., Ariti, C., Collier, T., and Wang, D. (2012). The win
ratio: a new approach to the analysis of composite endpoints in clinical
trials based on clinical priorities. <em>European Heart Journal</em>,
33, 176‚Äì182.</p></li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Lu Mao.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
